webpackJsonp([2],[function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function a(e,t,r){return i('\n      <li>\n        <span class="fa fa-times delete"></span>\n        <span>'+v(e)+": "+v(t)+" - "+v(r)+"</span>\n      </li>").data("type",e).data("area",t).data("name",r)}function o(){i(".control .markers").find("#marker-city").prop("checked",!0),i(".control .markers").find(".name").val(""),i(".select .markers").removeClass("active"),i(".control .markers").removeClass("active"),i(".control").removeClass("active"),i(".control .heatmaps").find("#heatmap-city").prop("checked",!0),i(".control .heatmaps").find(".name").val(""),i(".control .heatmaps").find(".variable").val(""),i(".select .heatmaps").removeClass("active"),i(".control .heatmaps").removeClass("active"),i(".control").removeClass("active"),i(".control .geometry").find("#geometry-city").prop("checked",!0),i(".control .geometry").find(".name").val(""),i(".control .geometry").find(".gran").val(""),i(".select .geometry").removeClass("active"),i(".control .geometry").removeClass("active"),i(".control").removeClass("active")}var i=r(1),c=r(4),u=r(3),s=u.getToken,l=u.getVenues,f=u.getMap,p=r(2),v=p.capitalize,d=Object.freeze({markers:"markers",heatmaps:"heatmaps",geometry:"geometry"}),m=[],h=[],g=[];i(document).foundation(),c.init("map");var y=s();i(".select").on("click",".markers",function(e){e.preventDefault(),i(e.currentTarget).addClass("active").siblings().removeClass("active"),i(".control .markers").addClass("active").siblings().removeClass("active"),i(".control").addClass("active")}).on("click",".markers.active",function(e){e.preventDefault(),i(e.currentTarget).removeClass("active").siblings().removeClass("active"),i(".control .markers").removeClass("active").siblings().removeClass("active"),i(".control").removeClass("active")}).on("click",".heatmaps",function(e){e.preventDefault(),i(e.currentTarget).addClass("active").siblings().removeClass("active"),i(".control .heatmaps").addClass("active").siblings().removeClass("active"),i(".control").addClass("active")}).on("click",".heatmaps.active",function(e){e.preventDefault(),i(e.currentTarget).removeClass("active").siblings().removeClass("active"),i(".control .heatmaps").removeClass("active").siblings().removeClass("active"),i(".control").removeClass("active")}).on("click",".geometry",function(e){e.preventDefault(),i(e.currentTarget).addClass("active").siblings().removeClass("active"),i(".control .geometry").addClass("active").siblings().removeClass("active"),i(".control").addClass("active")}).on("click",".geometry.active",function(e){e.preventDefault(),i(e.currentTarget).removeClass("active").siblings().removeClass("active"),i(".control .geometry").removeClass("active").siblings().removeClass("active"),i(".control").removeClass("active")}),i(".controls .layers").on("click",".delete",function(e){e.preventDefault();var t=i(e.currentTarget).parent().data("type"),r=i(e.currentTarget).parent().data("area"),n=i(e.currentTarget).parent().data("name");switch(t){case d.markers:var a=function(){i(e.currentTarget).parent().remove();var r=i(".controls .layers").find("li").toArray().map(function(e){return{type:i(e).data("type"),area:i(e).data("area"),name:i(e).data("name")}}).filter(function(e){return e.type===t}),n=m.filter(function(e){var t=!0,n=!1,a=void 0;try{for(var o,i=r[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var c=o.value;if(e[c.area].toLowerCase()===c.name)return!0}}catch(u){n=!0,a=u}finally{try{!t&&i["return"]&&i["return"]()}finally{if(n)throw a}}return!1}).filter(function(e){return e.lat&&e.lon});return c.clearMarkers().addMarkers(n),"break"}();if("break"===a)break;case d.heatmaps:c.clearHeatmap(r,n),i(e.currentTarget).parent().remove();break;case d.geometry:c.clearGeometry(r,n),i(e.currentTarget).parent().remove()}}),i(".control .markers").on("click",".advanced",function(e){e.preventDefault()}).on("click",".add",function(e){e.preventDefault();var t=d.markers,r=i(".control .markers").find('input[type="radio"]:checked').val().trim().toLowerCase(),u=i(".control .markers").find(".name").val().trim().toLowerCase();if(r&&u){var s=i(".controls .layers").find("li").toArray().map(function(e){return{type:i(e).data("type"),area:i(e).data("area"),name:i(e).data("name")}}).filter(function(e){return e.type===t});if(!s.find(function(e){return e.area===r&&e.name===u})){i(".loading").toggle();var f=h.find(function(e){return e.area===r&&e.name===u})?Promise.resolve():y.then(function(e){return l({token:e,area:r,name:u})}).then(function(e){var t=m.map(function(e){return e.cd_pdv}),a=e.filter(function(e){return-1===t.indexOf(e.cd_pdv)});m.push.apply(m,n(a)),h.push({area:r,name:u})});f.then(function(){s.push({type:t,area:r,name:u});var e=m.filter(function(e){var t=!0,r=!1,n=void 0;try{for(var a,o=s[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;if(e[i.area].toLowerCase()===i.name)return!0}}catch(c){r=!0,n=c}finally{try{!t&&o["return"]&&o["return"]()}finally{if(r)throw n}}return!1}).filter(function(e){return e.lat&&e.lon});c.clearMarkers().addMarkers(e).fitBoundsMarkers(),i(".controls .layers").find("ul").append(a(t,r,u)),o(),i(".loading").toggle()})["catch"](function(){return i(".loading").toggle()})}}}).on("click",".cancel",function(e){e.preventDefault(),o()}),i(".control .heatmaps").on("click",".advanced",function(e){e.preventDefault()}).on("click",".add",function(e){if(e.preventDefault(),0!==i(".control .heatmaps").find(".variable").prop("selectedIndex")){var t=d.heatmaps,r=i(".control .heatmaps").find('input[type="radio"]:checked').val().trim().toLowerCase(),u=i(".control .heatmaps").find(".name").val().trim().toLowerCase(),s=i(".control .heatmaps").find(".variable").val().trim().toLowerCase();if(r&&u&&s){var f=i(".controls .layers").find("li").toArray().map(function(e){return{type:i(e).data("type"),area:i(e).data("area"),name:i(e).data("name")}}).filter(function(e){return e.type===t});if(!f.find(function(e){return e.area===r&&e.name===u})){i(".loading").toggle();var p=h.find(function(e){return e.area===r&&e.name===u})?Promise.resolve():y.then(function(e){return l({token:e,area:r,name:u})}).then(function(e){var t=m.map(function(e){return e.cd_pdv}),a=e.filter(function(e){return-1===t.indexOf(e.cd_pdv)});m.push.apply(m,n(a)),h.push({area:r,name:u})});p.then(function(){var e=m.filter(function(e){return e.lat&&e.lon&&e[s]}).filter(function(e){return e[r].toLowerCase()===u});c.addHeatmap(e,r,u,s),i(".controls .layers").find("ul").append(a(t,r,u)),o(),i(".loading").toggle()})["catch"](function(){return i(".loading").toggle()})}}}}).on("click",".cancel",function(e){e.preventDefault(),o()}),i(".control .geometry").on("click",".advanced",function(e){e.preventDefault()}).on("click",".add",function(e){if(e.preventDefault(),0!==i(".control .geometry").find(".variable").prop("selectedIndex")){var t=d.geometry,r=i(".control .geometry").find('input[type="radio"]:checked').val().trim().toLowerCase(),n=i(".control .geometry").find(".name").val().trim().toLowerCase(),u=i(".control .geometry").find(".gran").val().trim().toLowerCase(),s=i(".control .geometry").find(".variable").val().trim().toLowerCase();if(r&&n&&u&&s){var l=i(".controls .layers").find("li").toArray().map(function(e){return{type:i(e).data("type"),area:i(e).data("area"),name:i(e).data("name")}}).filter(function(e){return e.type===t});if(!l.length){i(".loading").toggle();var p=-1===g.filter(function(e){return e.area===r}).map(function(e){return e.name}).indexOf(n)?y.then(function(e){return f(e,r,n,u)}).then(function(e){return g.push({area:r,name:n,gran:u,shapes:e})}):Promise.resolve();p.then(function(){var e=g.find(function(e){return e.area===r&&e.name===n&&e.gran===u}).shapes;c.addGeometry(e,r,n,s),i(".controls .layers").find("ul").append(a(t,r,n)),o(),i(".loading").toggle()})["catch"](function(){return i(".loading").toggle()})}}}}).on("click",".cancel",function(e){e.preventDefault(),o()})},,function(e,t){"use strict";function r(e){return""+e[0].toUpperCase()+e.slice(1)}function n(e){return e>1e3?"#800026":e>500?"#BD0026":e>200?"#E31A1C":e>100?"#FC4E2A":e>50?"#FD8D3C":e>20?"#FEB24C":e>10?"#FED976":"#FFEDA0"}function a(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,new Error(t)}e.exports={capitalize:r,getColor:n,checkFetchStatus:a}},function(e,t,r){"use strict";function n(){return fetch("./api/v1/token",{credentials:"same-origin"}).then(c).then(function(e){return e.text()})}function a(e){var t=Object.keys(e),r=t.map(function(t){return t+"="+e[t]});return fetch("./api/v1/venues?"+r.join("&")).then(c).then(function(e){return e.json()})}function o(e,t,r,n){return fetch("./api/v1/map?area="+t+"&name="+r+"&gran="+n+"&token="+e).then(c).then(function(e){return e.json()})}var i=r(2),c=i.checkFetchStatus;e.exports={getToken:n,getVenues:a,getMap:o}},function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function a(e){function t(e){var t=e.ds_pdv,r=Object.keys(e).filter(function(e){return"ds_pdv"!==e}).map(function(t){return t==="<br><p>"+(e[t]||"-")+"</p>"});return"<div>"+t+r+"</div>"}return s.marker([e.lat,e.lon]).bindPopup(t(e))}function o(e,t){return[e.lat,e.lon,e[t]]}var i=r(9),c=r(2),u=c.getColor,s=window.L;s.TopoJSON=s.GeoJSON.extend({addData:function(e){if("Topology"===e.type)for(var t in e.objects){var r=i.feature(e,e.objects[t]);s.GeoJSON.prototype.addData.call(this,r)}else s.GeoJSON.prototype.addData.call(this,e);return this}}),s.topoJson=function(e,t){return new s.TopoJSON(e,t)};var l="https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",f={attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',id:"mapbox.light",accessToken:"pk.eyJ1IjoibXluZGZsYW1lIiwiYSI6ImNpbXJ1am85cDAwNGx2OW0xbnU0amdkZHgifQ.56NzZw6OPm41VEqhaqGHAA"},p=null,v=null,d=null,m=null,h=null,g=null,y=null;e.exports={init:function(e){p=s.map(e,{zoomControl:!1}).setView([40.417049,-3.703525],6),s.control.zoom({position:"bottomleft"}).addTo(p),v=s.control(),v.onAdd=function(e){return this._div=s.DomUtil.create("div","info"),this.update(),this._div},v.update=function(e){var t="";if(e)for(var r in e)e.hasOwnProperty(r)&&(t+=r+": "+e[r]+"<br>");else t="Hover over an area";this._div.innerHTML="<h4>Area Data</h4>"+t},d=s.control({position:"bottomright"}),d.onAdd=function(e){for(var t=s.DomUtil.create("div","info legend"),r=[0,10,20,50,100,200,500,1e3],n=0;n<r.length;n++)t.innerHTML+='\n          <i style="background:'+u(r[n]+1)+'"></i>\n          <span>'+r[n]+(r[n+1]?"&ndash;"+r[n+1]+"<br>":"+")+"</span>";return t},m=s.tileLayer(l,f).addTo(p),h=s.markerClusterGroup({disableClusteringAtZoom:18}).addTo(p),g=[],y=[]},clearMarkers:function(){return h.clearLayers(),this},addMarkers:function(e){return e.length&&h.addLayers(e.map(a)),this},fitBoundsMarkers:function(){return p.fitBounds(h.getBounds()),this},clearHeatmaps:function(){for(;g.length;){var e=g.shift();p.removeLayer(e.heatmap)}return this},clearHeatmap:function(e,t){var r=g.reduce(function(r,n,a){return n.area===e&&n.name===t?a:r},-1);return-1!==r&&(p.removeLayer(g[r].heatmap),g=[].concat(n(g.slice(0,r)),n(g.slice(r+1)))),this},addHeatmap:function(e,t,r,a){var i=e.map(function(e){return o(e,a)}),c=Math.max.apply(Math,n(i.map(function(e){return e[2]}).sort(function(e,t){return t-e}).slice(.1*i.length))),u=s.heatLayer(i,{radius:25,max:c});return u.addTo(p),g.push({area:t,name:r,heatmap:u}),this},fitBoundsHeatmaps:function(){return this},clearGeometries:function(){for(;y.length;){var e=y.shift();p.removeLayer(e.geometry)}return this},clearGeometry:function(e,t){var r=y.reduce(function(r,n,a){return n.area===e&&n.name===t?a:r},-1);return-1!==r&&(p.removeLayer(y[r].geometry),y=[].concat(n(y.slice(0,r)),n(y.slice(r+1)))),p.removeControl(v),p.removeControl(d),p.setView([40.417049,-3.703525],6),this},addGeometry:function(e,t,r,n){var a=s.topoJson(null,{onEachFeature:function(e,t){t.on({mouseover:function(e){e.target.setStyle({weight:2,color:"#666",dashArray:"",fillOpacity:.7}),s.Browser.ie||s.Browser.opera||e.target.bringToFront(),v.update(e.target.feature.properties)},mouseout:function(e){a.resetStyle(e.target),v.update()},click:function(e){p.fitBounds(e.target.getBounds())}})},style:function(e){return{fillColor:u(e.properties[n]),fillOpacity:.7,weight:1,opacity:1,color:"white",dashArray:"3"}}}).addData(e).addTo(p);return y.push({area:t,name:r,geometry:a}),v.addTo(p),d.addTo(p),this},fitBoundsGeometries:function(){return p.fitBounds(y.getBounds()),this}}},,,,,function(e,t,r){!function(e,r){r(t)}(this,function(e){"use strict";function t(){}function r(e){if(!e)return t;var r,n,a=e.scale[0],o=e.scale[1],i=e.translate[0],c=e.translate[1];return function(e,t){t||(r=n=0),e[0]=(r+=e[0])*a+i,e[1]=(n+=e[1])*o+c}}function n(e){if(!e)return t;var r,n,a=e.scale[0],o=e.scale[1],i=e.translate[0],c=e.translate[1];return function(e,t){t||(r=n=0);var u=Math.round((e[0]-i)/a),s=Math.round((e[1]-c)/o);e[0]=u-r,e[1]=s-n,r=u,n=s}}function a(e,t){for(var r,n=e.length,a=n-t;a<--n;)r=e[a],e[a++]=e[n],e[n]=r}function o(e,t){for(var r=0,n=e.length;n>r;){var a=r+n>>>1;e[a]<t?r=a+1:n=a}return r}function i(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return c(e,t)})}:c(e,t)}function c(e,t){var r={type:"Feature",id:t.id,properties:t.properties||{},geometry:u(e,t)};return null==t.id&&delete r.id,r}function u(e,t){function n(e,t){t.length&&t.pop();for(var r,n=f[0>e?~e:e],o=0,i=n.length;i>o;++o)t.push(r=n[o].slice()),l(r,o);0>e&&a(t,i)}function o(e){return e=e.slice(),l(e,0),e}function i(e){for(var t=[],r=0,a=e.length;a>r;++r)n(e[r],t);return t.length<2&&t.push(t[0].slice()),t}function c(e){for(var t=i(e);t.length<4;)t.push(t[0].slice());return t}function u(e){return e.map(c)}function s(e){var t=e.type;return"GeometryCollection"===t?{type:t,geometries:e.geometries.map(s)}:t in p?{type:t,coordinates:p[t](e)}:null}var l=r(e.transform),f=e.arcs,p={Point:function(e){return o(e.coordinates)},MultiPoint:function(e){return e.coordinates.map(o)},LineString:function(e){return i(e.arcs)},MultiLineString:function(e){return e.arcs.map(i)},Polygon:function(e){return u(e.arcs)},MultiPolygon:function(e){return e.arcs.map(u)}};return s(t)}function s(e,t){function r(t){var r,n=e.arcs[0>t?~t:t],a=n[0];return e.transform?(r=[0,0],n.forEach(function(e){r[0]+=e[0],r[1]+=e[1]})):r=n[n.length-1],0>t?[r,a]:[a,r]}function n(e,t){for(var r in e){var n=e[r];delete t[n.start],delete n.start,delete n.end,n.forEach(function(e){a[0>e?~e:e]=1}),c.push(n)}}var a={},o={},i={},c=[],u=-1;return t.forEach(function(r,n){var a,o=e.arcs[0>r?~r:r];o.length<3&&!o[1][0]&&!o[1][1]&&(a=t[++u],t[u]=r,t[n]=a)}),t.forEach(function(e){var t,n,a=r(e),c=a[0],u=a[1];if(t=i[c])if(delete i[t.end],t.push(e),t.end=u,n=o[u]){delete o[n.start];var s=n===t?t:t.concat(n);o[s.start=t.start]=i[s.end=n.end]=s}else o[t.start]=i[t.end]=t;else if(t=o[u])if(delete o[t.start],t.unshift(e),t.start=c,n=i[c]){delete i[n.end];var l=n===t?t:n.concat(t);o[l.start=n.start]=i[l.end=t.end]=l}else o[t.start]=i[t.end]=t;else t=[e],o[t.start=c]=i[t.end=u]=t}),n(i,o),n(o,i),t.forEach(function(e){a[0>e?~e:e]||c.push([e])}),c}function l(e){return u(e,f.apply(this,arguments))}function f(e,t,r){function n(e){var t=0>e?~e:e;(l[t]||(l[t]=[])).push({i:e,g:u})}function a(e){e.forEach(n)}function o(e){e.forEach(a)}function i(e){"GeometryCollection"===e.type?e.geometries.forEach(i):e.type in f&&(u=e,f[e.type](e.arcs))}var c=[];if(arguments.length>1){var u,l=[],f={LineString:a,MultiLineString:o,Polygon:o,MultiPolygon:function(e){e.forEach(o)}};i(t),l.forEach(arguments.length<3?function(e){c.push(e[0].i)}:function(e){r(e[0].g,e[e.length-1].g)&&c.push(e[0].i)})}else for(var p=0,v=e.arcs.length;v>p;++p)c.push(p);return{type:"MultiLineString",arcs:s(e,c)}}function p(e){var t=e[0],r=e[1],n=e[2];return Math.abs((t[0]-n[0])*(r[1]-t[1])-(t[0]-r[0])*(n[1]-t[1]))}function v(e){for(var t,r=-1,n=e.length,a=e[n-1],o=0;++r<n;)t=a,a=e[r],o+=t[0]*a[1]-t[1]*a[0];return o/2}function d(e){return u(e,m.apply(this,arguments))}function m(e,t){function r(e){e.forEach(function(t){t.forEach(function(t){(a[t=0>t?~t:t]||(a[t]=[])).push(e)})}),o.push(e)}function n(t){return Math.abs(v(u(e,{type:"Polygon",arcs:[t]}).coordinates[0]))}var a={},o=[],i=[];return t.forEach(function(e){"Polygon"===e.type?r(e.arcs):"MultiPolygon"===e.type&&e.arcs.forEach(r)}),o.forEach(function(e){if(!e._){var t=[],r=[e];for(e._=1,i.push(t);e=r.pop();)t.push(e),e.forEach(function(e){e.forEach(function(e){a[0>e?~e:e].forEach(function(e){e._||(e._=1,r.push(e))})})})}}),o.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:i.map(function(t){var r,o=[];if(t.forEach(function(e){e.forEach(function(e){e.forEach(function(e){a[0>e?~e:e].length<2&&o.push(e)})})}),o=s(e,o),(r=o.length)>1)for(var i,c,u=1,l=n(o[0]);r>u;++u)(i=n(o[u]))>l&&(c=o[0],o[0]=o[u],o[u]=c,l=i);return o})}}function h(e){function t(e,t){e.forEach(function(e){0>e&&(e=~e);var r=a[e];r?r.push(t):a[e]=[t]})}function r(e,r){e.forEach(function(e){t(e,r)})}function n(e,t){"GeometryCollection"===e.type?e.geometries.forEach(function(e){n(e,t)}):e.type in c&&c[e.type](e.arcs,t)}var a={},i=e.map(function(){return[]}),c={LineString:t,MultiLineString:r,Polygon:r,MultiPolygon:function(e,t){e.forEach(function(e){r(e,t)})}};e.forEach(n);for(var u in a)for(var s=a[u],l=s.length,f=0;l>f;++f)for(var p=f+1;l>p;++p){var v,d=s[f],m=s[p];(v=i[d])[u=o(v,m)]!==m&&v.splice(u,0,m),(v=i[m])[u=o(v,d)]!==d&&v.splice(u,0,d)}return i}function g(e,t){return e[1][2]-t[1][2]}function y(){function e(e,t){for(;t>0;){var r=(t+1>>1)-1,a=n[r];if(g(e,a)>=0)break;n[a._=t]=a,n[e._=t=r]=e}}function t(e,t){for(;;){var r=t+1<<1,o=r-1,i=t,c=n[i];if(a>o&&g(n[o],c)<0&&(c=n[i=o]),a>r&&g(n[r],c)<0&&(c=n[i=r]),i===t)break;n[c._=t]=c,n[e._=t=i]=e}}var r={},n=[],a=0;return r.push=function(t){return e(n[t._=a]=t,a++),a},r.pop=function(){if(!(0>=a)){var e,r=n[0];return--a>0&&(e=n[a],t(n[e._=0]=e,0)),r}},r.remove=function(r){var o,i=r._;return n[i]===r?(i!==--a&&(o=n[a],(g(o,r)<0?e:t)(n[o._=i]=o,i)),i):void 0},r}function k(e,t){function a(e){c.remove(e),e[1][2]=t(e),c.push(e)}var o=r(e.transform),i=n(e.transform),c=y();return t||(t=p),e.arcs.forEach(function(e){var r,n,u,s,l=[],f=0;for(n=0,u=e.length;u>n;++n)s=e[n],o(e[n]=[s[0],s[1],1/0],n);for(n=1,u=e.length-1;u>n;++n)r=e.slice(n-1,n+2),r[1][2]=t(r),l.push(r),c.push(r);for(n=0,u=l.length;u>n;++n)r=l[n],r.previous=l[n-1],r.next=l[n+1];for(;r=c.pop();){var p=r.previous,v=r.next;r[1][2]<f?r[1][2]=f:f=r[1][2],p&&(p.next=v,p[2]=r[2],a(p)),v&&(v.previous=p,v[0]=r[0],a(v))}e.forEach(i)}),e}var C="1.6.26";e.version=C,e.mesh=l,e.meshArcs=f,e.merge=d,e.mergeArcs=m,e.feature=i,e.neighbors=h,e.presimplify=k})}]);